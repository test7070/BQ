z_vcc_bq1:
declare @bdate nvarchar(20)
declare @edate nvarchar(20)
set @bdate = case when '#non'=[2] then '' else [2] end
set @edate = case when '#non'=[3] then char(255) else [3] end
declare @tmp table(
	gno nvarchar(5),
	datea nvarchar(20),
	typea nvarchar(5),
	noa nvarchar(20),
	noq nvarchar(5),
	custno nvarchar(10),
	comp nvarchar(100),
	money float,
	product nvarchar(100),
	spec nvarchar(20),
	unit nvarchar(10),
	mount float,
	weight float,
	price float,
	tax float,
	total float,
	total2 float
)
insert into @tmp (gno,datea,typea,noa,noq,custno,comp,money,product,spec,unit,mount,weight,price,tax,total)
select '0',a.datea,case when a.typea='1' then '出' else '退' end,a.noa,b.noq,a.custno,c.nick,a.money,b.product,b.spec,b.unit,b.mount,b.weight,b.price,a.tax,b.total
from view_vcc a
left join view_vccs b on a.noa = b.noa
left join cust c on a.custno = c.noa
where a.datea between @bdate and @edate

update @tmp set datea='',typea='',noa='',custno='',comp='',money = null where noq!='001'
update @tmp set total2 = case when typea='退' then money end


insert into @tmp (gno,money,total2,weight,tax)
select '1',SUM(money)-SUM(total2),SUM(total2),SUM(weight),SUM(tax)
from @tmp

select * from @tmp;